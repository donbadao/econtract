"use strict";(self["webpackChunkecontract_frontend"]=self["webpackChunkecontract_frontend"]||[]).push([[607],{2847:function(t,s,a){a.d(s,{Z:function(){return c}});var e=function(){var t=this,s=t._self._c;return s("div",{staticClass:"col flex-column text-center"},[s("svg",{attrs:{width:"100",height:"100"}},[s("svg",{attrs:{id:"Layer_1","data-name":"Layer 1",viewBox:"0 0 208 230"}},[s("defs",[s("linearGradient",{attrs:{id:"colorNodata",x1:"133.69",y1:"120.61",x2:"73.06",y2:"91.22",gradientTransform:"matrix(1, 0, 0, -1, 0, 231.28)",gradientUnits:"userSpaceOnUse"}},[s("stop",{attrs:{offset:"0","stop-color":"#95abc2"}}),s("stop",{attrs:{offset:"1","stop-color":"#fff"}})],1),s("mask",{attrs:{id:"maskColorNodata",x:"134.5",y:"14.55",width:"17.97",height:"17.21",maskUnits:"userSpaceOnUse"}},[s("g",{attrs:{id:"handFlag"}},[s("path",{attrs:{d:"M137,24a8.1,8.1,0,0,1,8.1-8.1h6.3v6.3a8.1,8.1,0,0,1-8.1,8.1H137Z",fill:"#fff"}})])])],1),s("path",{attrs:{d:"M94.2,85.7l85.9,23.6v82.6l-85.9-37Z",fill:"#8e99a3"}}),s("path",{attrs:{d:"M94.3,85.7,24.1,105.3v86.8l70.1-37.6Z",fill:"#a0aab5"}}),s("path",{attrs:{d:"M139.4,185.9c-19.4-5.7-53.4-5.2-66.2-38.3-11.7-30.4,31.5-59.6,43.6-46.8,8.6,9.1-2.4,22.2-17.7,20.7C82,119.8,71.9,104.5,75.3,88c6.7-32.7,58.3-54.4,60.5-55.9",fill:"none","stroke-width":"3","stroke-dasharray":"6 7",stroke:"url(#colorNodata)"}}),s("path",{attrs:{d:"M141,21.5s-.5-12.3-3.7-15.6a8.4,8.4,0,0,0-11.8,11.8C128.7,21,141,21.5,141,21.5Z",fill:"#ced8e5",opacity:"0.4"}}),s("path",{attrs:{d:"M146.7,26.4s.5,12.3,3.7,15.6a8.4,8.4,0,0,0,11.8-11.8C159.1,26.9,146.7,26.4,146.7,26.4Z",fill:"#ced8e5",opacity:"0.4"}}),s("path",{attrs:{d:"M137,24a8.1,8.1,0,0,1,8.1-8.1h6.3v6.3a8.1,8.1,0,0,1-8.1,8.1H137Z",fill:"#a8b7c5"}}),s("g",{attrs:{mask:"url(#maskColorNodata)"}},[s("rect",{attrs:{x:"140.1",y:"16.7",width:"2.3",height:"16.69",transform:"translate(23.6 107.2) rotate(-45)",fill:"#dde5f2"}}),s("path",{attrs:{d:"M139.1,16.2l1.6-1.6,11.8,11.8L150.9,28Z",fill:"#dde5f2"}})]),s("path",{attrs:{d:"M159.2,12.3l5.5-1.3",fill:"none",stroke:"#8696c5","stroke-width":"0.9"}}),s("path",{attrs:{d:"M156.9,10.1l2.1-5.5",fill:"none",stroke:"#8696c5","stroke-width":"0.9"}}),s("path",{attrs:{d:"M153.7,20.5a6.1,6.1,0,1,0-6.1-6.1A6.1,6.1,0,0,0,153.7,20.5Z",fill:"#8b9aa8"}}),s("path",{attrs:{d:"M24.1,105.5,110,132.8V229L24.1,192Z",fill:"#dae2ec"}}),s("path",{attrs:{d:"M180.5,109.2l-71.7,23.6V229l71.7-37Z",fill:"#c5d0d9"}}),s("path",{attrs:{d:"M180.3,109.1,208,146.2l-73.6,29L109,132.6Z",fill:"#dae2ec"}}),s("path",{attrs:{d:"M24,105.3,0,142.8l84.6,32.4,24.7-42.7Z",fill:"#c5d0d9"}})])]),s("h4",{staticClass:"text-center font-size-20px mb-2 text-no--data text-primary"},[t._v("Chưa có dữ liệu")]),s("div",{staticClass:"text-muted"},[t._v("Hãy thêm dữ liệu hoặc Kiểm tra lại thông tin tra cứu")])])},o=[],i=a(1001),n={},r=(0,i.Z)(n,e,o,!1,null,null,null),c=r.exports},886:function(t,s,a){a.r(s),a.d(s,{default:function(){return Y}});var e=function(){var t=this,s=t._self._c;return s("div",{attrs:{id:"create-commissions"}},[s("div",{staticClass:"row"},[s("div",{staticClass:"col-8 offset-2"},[s("div",{staticClass:"card"},[s("div",{staticClass:"card-body"},[s("h1",{staticClass:"fw-bold"},[t._v(t._s(t.asset.title))]),s("div",{staticClass:"row"},[s("div",{staticClass:"col-12"},[s("div",{staticClass:"form-group mb-2"},[s("label",{attrs:{for:""}},[t._v("Đợt thanh toán")]),s("div",{staticClass:"input-group"},[s("input",{directives:[{name:"model",rawName:"v-model",value:t.Commission.turn_name,expression:"Commission.turn_name"}],staticClass:"form-control",attrs:{placeholder:"Chọn đợt thanh toán",type:"text",disabled:"true"},domProps:{value:t.Commission.turn_name},on:{input:function(s){s.target.composing||t.$set(t.Commission,"turn_name",s.target.value)}}}),s("button",{staticClass:"input-group-text",on:{click:t.showModalTurn}},[s("i",{staticClass:"fa-solid fa-magnifying-glass"})]),s("button",{staticClass:"input-group-text",attrs:{title:"Thêm đợt thanh toán"},on:{click:t.addTurn}},[s("i",{staticClass:"fa-solid fa-plus"})])])])])]),s("div",{staticClass:"row"},[s("div",{staticClass:"col-6"},[s("div",{staticClass:"form-group mb-2"},[s("label",{attrs:{for:""}},[t._v("Chọn hợp đồng")]),s("div",{staticClass:"input-group"},[s("input",{directives:[{name:"model",rawName:"v-model",value:t.asset.company_name,expression:"asset.company_name"}],staticClass:"form-control",attrs:{placeholder:"Chọn đợt thanh toán",type:"text",disabled:"true"},domProps:{value:t.asset.company_name},on:{input:function(s){s.target.composing||t.$set(t.asset,"company_name",s.target.value)}}}),s("button",{staticClass:"input-group-text",on:{click:t.showModalContract}},[s("i",{staticClass:"fa-solid fa-magnifying-glass"})])])])]),s("div",{staticClass:"col-6"},[s("div",{staticClass:"form-group"},[s("label",{attrs:{for:""}},[t._v("Chọn công tác viên:")]),s("select",{directives:[{name:"model",rawName:"v-model",value:t.Commission.partner_id,expression:"Commission.partner_id"}],staticClass:"form-select",on:{change:function(s){var a=Array.prototype.filter.call(s.target.options,(function(t){return t.selected})).map((function(t){var s="_value"in t?t._value:t.value;return s}));t.$set(t.Commission,"partner_id",s.target.multiple?a:a[0])}}},[s("option",{attrs:{value:"0"}},[t._v("--Chọn cộng tác viên--")]),t._l(t.partners,(function(a){return s("option",{key:a.partner_id,domProps:{value:a.partner_id}},[t._v(" "+t._s(a.partner_name)+" ")])}))],2)])])]),s("ul",{staticClass:"list-group mt-2"},[t.asset.company_name?s("li",{staticClass:"list-group-item bg-light"},[s("h6",{staticClass:"m-0 fw-bold"},[t._v(t._s(t.asset.company_name))])]):t._e(),s("li",{staticClass:"list-group-item"},[s("div",{staticClass:"row"},[s("div",{staticClass:"col-6"},[s("span",{staticClass:"fw-bold"},[t._v(" Số hợp đồng : ")]),t._v(" "+t._s(t.asset.contract.contract_number)+"/"+t._s(t.asset.contract.contract_number_pattern)+" ")]),s("div",{staticClass:"col-6"},[s("span",{staticClass:"fw-bold"},[t._v(" Ngày hợp đồng : ")]),t._v(t._s(t._f("moment")(t.asset.contract.contract_date,"DD/MM/YYYY"))+" ")])])]),t.asset.contract.details?[t._m(0),s("li",{staticClass:"list-group-item p-0"},[s("table",{staticClass:"table table-striped table-responsive"},[t._m(1),s("tbody",t._l(t.asset.contract.details,(function(a,e){return s("tr",{key:a.detail_id},[s("td",[t._v(t._s(e+1))]),s("td",[t._v(t._s(a.detail_content))]),s("td",[t._v(t._s(a.detail_quantity))]),s("td",[s("strong",{staticClass:"text-danger"},[t._v(t._s(t._f("formatamout")(a.detail_product_price)))])]),s("td",[s("button",{staticClass:"btn btn-danger-soft btn-xs",attrs:{title:"Xóa dịch vụ"},on:{click:function(s){return t.removeDetail(e)}}},[s("i",{staticClass:"fa-regular fa-trash-can"})])])])})),0)])])]:t._e()],2),s("ul",{staticClass:"list-group mt-1"},[s("li",{staticClass:"list-group-item"},[s("div",{staticClass:"row"},[s("div",{staticClass:"col-4"},[s("div",{staticClass:"form-group"},[s("label",{attrs:{for:""}},[t._v("Tiền trước thuế:")]),t._v(" "+t._s(t.asset.product_price)+" "),s("money",t._b({staticClass:"form-control text-end",model:{value:t.asset.product_price,callback:function(s){t.$set(t.asset,"product_price",s)},expression:"asset.product_price"}},"money",t.money,!1))],1)]),s("div",{staticClass:"col-4"},[s("div",{staticClass:"form-group"},[s("label",{attrs:{for:""}},[t._v("Phần trăm hoa hồng:")]),s("input",{directives:[{name:"model",rawName:"v-model.lazy",value:t.asset.percent,expression:"asset.percent",modifiers:{lazy:!0}}],staticClass:"form-control text-end",attrs:{type:"number"},domProps:{value:t.asset.percent},on:{change:function(s){return t.$set(t.asset,"percent",s.target.value)}}})])]),s("div",{staticClass:"col-4"},[s("div",{staticClass:"form-group"},[s("label",{attrs:{for:""}},[t._v("Tiền tiền thuế:")]),s("money",t._b({staticClass:"form-control text-end",model:{value:t.asset.comis_price,callback:function(s){t.$set(t.asset,"comis_price",s)},expression:"asset.comis_price"}},"money",t.money,!1))],1)])])]),s("li",{staticClass:"list-group-item"},[s("button",{staticClass:"btn btn-primary-soft w-100",on:{click:function(s){return t.addCommission()}}},[s("i",{staticClass:"fa-thin fa-circle-plus"}),t._v(" Thêm phiếu thanh toán ")])])]),s("div",{staticClass:"row"},t._l(t.filteredComissions,(function(a,e){return s("div",{key:a.detail_id,staticClass:"col-12 mt-1"},[s("div",{staticClass:"card"},[s("div",{staticClass:"card-header"},[s("div",{staticClass:"d-flex ms-auto"},[s("h5",{staticClass:"card-title m-0"},[t._v(t._s(a.company_name))]),s("div",{staticClass:"d-flex ms-auto"},[s("button",{staticClass:"btn btn-danger-soft btn-sm",on:{click:function(s){return t.removeDetailItem(e)}}},[s("i",{staticClass:"fa-regular fa-trash-can"})])])])]),s("div",{staticClass:"card-body"},[s("h6",{staticClass:"text-danger fw-bold"},[t._v(" Dịch vụ : "+t._s(a.cate_name)+" - "+t._s(a.product_name)+" ")]),s("div",{staticClass:"form-group"},[s("label",{attrs:{for:""}},[t._v("Nội dung thanh toán")]),s("input",{directives:[{name:"model",rawName:"v-model",value:a.detail_content,expression:"item.detail_content"}],staticClass:"form-control",attrs:{type:"text",placeholder:"Nội dung thanh toán"},domProps:{value:a.detail_content},on:{input:function(s){s.target.composing||t.$set(a,"detail_content",s.target.value)}}})]),s("div",{staticClass:"row"},[s("div",{staticClass:"col-6"},[s("div",{staticClass:"form-group"},[s("label",{attrs:{for:""}},[t._v("Doanh thu")]),s("money",t._b({staticClass:"form-control text-end",model:{value:a.revenue,callback:function(s){t.$set(a,"revenue",s)},expression:"item.revenue"}},"money",t.money,!1))],1)]),s("div",{staticClass:"col-6"},[s("div",{staticClass:"form-group"},[s("label",{attrs:{for:""}},[t._v("Số tiền thanh toán")]),s("money",t._b({staticClass:"form-control text-end",model:{value:a.comis_price,callback:function(s){t.$set(a,"comis_price",s)},expression:"item.comis_price"}},"money",t.money,!1))],1)])])])])])})),0),s("div",{staticClass:"row mt-1"},[s("div",{staticClass:"col-12"},[s("div",{staticClass:"card"},[t._m(2),s("div",{staticClass:"card-body"},[s("div",{staticClass:"form-group"},[s("label",{attrs:{for:""}},[t._v("Tổng tiền thanh toán:")]),s("money",t._b({staticClass:"form-control text-end",model:{value:t.Commission.comis_total,callback:function(s){t.$set(t.Commission,"comis_total",s)},expression:"Commission.comis_total"}},"money",t.money,!1))],1),s("div",{staticClass:"form-group"},[s("label",{attrs:{for:""}},[t._v("Số tiền bằng chữ:")]),s("input",{directives:[{name:"model",rawName:"v-model",value:t.Commission.price_to_text,expression:"Commission.price_to_text"}],staticClass:"form-control",attrs:{type:"text",placeholder:"Tổng số tiền thanh toán bằng chữ"},domProps:{value:t.Commission.price_to_text},on:{input:function(s){s.target.composing||t.$set(t.Commission,"price_to_text",s.target.value)}}})])])])])]),t.Commission.details.length>0?s("div",{staticClass:"row mt-2"},[s("div",{staticClass:"col-12"},[s("button",{staticClass:"btn btn-primary-soft",on:{click:function(s){return t.store()}}},[s("i",{staticClass:"fa-solid fa-floppy-disk"}),t._v(" Lưu dữ liệu ")]),s("router-link",{staticClass:"btn btn-secondary ms-1",attrs:{to:{name:"commission-index"}}},[s("i",{staticClass:"fa-solid fa-arrow-left"}),t._v(" Quay lại")])],1)]):t._e()])])])]),s("turnChoose",{ref:"turnChoose",on:{chooseTurn:t.chooseTurn}}),s("turnAdd",{ref:"turnAdd",on:{turnAddSuccess:t.turnAddSuccess}}),s("modalContractComission",{ref:"modalContract",on:{chooseContract:t.chooseContract}})],1)},o=[function(){var t=this,s=t._self._c;return s("li",{staticClass:"list-group-item bg-light"},[s("div",{staticClass:"fw-bold"},[t._v("Danh sách dịch vụ")])])},function(){var t=this,s=t._self._c;return s("thead",[s("tr",[s("th",{attrs:{width:"10"}},[t._v("#")]),s("th",{attrs:{width:"60%"}},[t._v("Tên dịch vụ")]),s("th",[t._v("SL")]),s("th",[t._v("Tiền trước thuế")]),s("th",{attrs:{width:"10"}})])])},function(){var t=this,s=t._self._c;return s("div",{staticClass:"card-header"},[s("div",{staticClass:"card-title"},[t._v("Thanh toán")])])}],i=(a(560),a(1859)),n=function(){var t=this,s=t._self._c;return t.isShow?s("b-modal",{attrs:{id:"modalTurnChoose",title:"Danh sách đợt thanh toán","no-close-on-backdrop":"","no-fade":"",size:"lg","hide-footer":""}},[s("div",{staticStyle:{height:"400px",overflow:"hidden auto"}},[s("table",{staticClass:"table table-hover"},[s("thead",{staticClass:"table-dark"},[s("tr",[s("th",{staticClass:"rounded-start"},[t._v("Tên đợt")]),s("th",[t._v("Ngày lập")]),s("th",{staticClass:"rounded-end",attrs:{width:"10"}})])]),s("tbody",t._l(t.turns,(function(a){return s("tr",{key:a.turn_id},[s("td",[t._v(t._s(a.turn_name))]),s("td",[t._v(t._s(t._f("moment")(a.turn_date,"DD/MM/YYYY")))]),s("td",[s("button",{staticClass:"btn btn-primary-soft btn-sm",on:{click:function(s){return t.choose(a)}}},[s("i",{staticClass:"fa-regular fa-circle-arrow-right"})])])])})),0)]),0==t.turns.length?s("NotFoundVue"):t._e()],1)]):t._e()},r=[],c=a(2847),l=(a(9773),{components:{NotFoundVue:c.Z},data(){return{isShow:!0,turns:[]}},created(){},methods:{choose(t){this.$emit("chooseTurn",t),this.$bvModal.hide("modalTurnChoose"),this.$toast.success("Thêm đợt thành công")},show(){this.$bvModal.show("modalTurnChoose"),this.getTurns()},async getTurns(){this.$econtract.showLoading(),await i.Z.get("/turns").then((t=>{this.turns=t.data,this.$econtract.hideLoading()}))}}}),d=l,m=a(1001),h=(0,m.Z)(d,n,r,!1,null,null,null),u=h.exports,p=function(){var t=this,s=t._self._c;return s("b-modal",{ref:"modalDetail",attrs:{id:"modal-add-turn","hide-header-close":"","no-close-on-backdrop":"","no-fade":"",size:"md","ignore-enforce-focus-selector":"span.select2-container",title:"Thêm đợt thanh toán"},scopedSlots:t._u([{key:"modal-footer",fn:function(){return[s("button",{staticClass:"btn btn-primary-soft",on:{click:t.saveTurn}},[s("i",{staticClass:"fa-thin fa-floppy-disk"}),t._v(" Lưu ")]),s("button",{staticClass:"btn btn-secondary",on:{click:function(s){return t.$bvModal.hide("modal-add-turn")}}},[s("i",{staticClass:"fa-thin fa-xmark"}),t._v(" Đóng ")])]},proxy:!0}])},[s("div",{staticClass:"row"},[s("div",{staticClass:"col-12"},[s("div",{staticClass:"form-group"},[s("label",{attrs:{for:""}},[t._v("Tên đợt")]),s("input",{directives:[{name:"model",rawName:"v-model",value:t.Turn.turn_name,expression:"Turn.turn_name"}],staticClass:"form-control",attrs:{type:"text",placeholder:"Nhập tên đợt thanh toán"},domProps:{value:t.Turn.turn_name},on:{input:function(s){s.target.composing||t.$set(t.Turn,"turn_name",s.target.value)}}})]),s("div",{staticClass:"form-group"},[s("label",[t._v("Ngày tạo đợt")]),s("date-picker",{attrs:{config:t.options},model:{value:t.Turn.turn_date,callback:function(s){t.$set(t.Turn,"turn_date",s)},expression:"Turn.turn_date"}})],1)])])])},_=[],f=a(8915),C=a.n(f),v={components:{datePicker:C()},data(){return{Turn:{turn_name:"",turn_date:this.$econtract.formatDate(new Date),turn_status:0},options:{format:"DD/MM/YYYY",useCurrent:!1}}},methods:{async saveTurn(){await i.Z.post("/turns",this.Turn).then((t=>{this.$emit("turnAddSuccess",t.data),this.$toast.success("Thêm đợt thanh toán thành công"),this.$bvModal.hide("modal-add-turn")}))},show(){this.$bvModal.show("modal-add-turn")}}},g=v,b=(0,m.Z)(g,p,_,!1,null,null,null),y=b.exports,x=a(8881),w=function(){var t=this,s=t._self._c;return s("b-modal",{ref:"modalDetail",attrs:{id:"modal-add-contract-comission","hide-header-close":"","no-close-on-backdrop":"","no-fade":"",size:"xl","ignore-enforce-focus-selector":"span.select2-container",title:"Chọn hợp đồng"},scopedSlots:t._u([{key:"modal-footer",fn:function(){return[s("button",{staticClass:"btn btn-secondary",on:{click:function(s){return t.$bvModal.hide("modal-add-contract-comission")}}},[s("i",{staticClass:"fa-thin fa-xmark"}),t._v(" Đóng ")])]},proxy:!0}])},[s("div",{staticClass:"tableFixHead"},[s("table",{staticClass:"table table-striped table"},[s("thead",[s("tr",[s("th",[t._v("#")]),s("th",{attrs:{width:"50%"}},[t._v("Tên công ty")]),s("th",[t._v("Mã số thuế")]),s("th",[t._v("Trạng thái")]),s("th",[t._v("Tổng tiền")]),s("th")])]),s("tbody",[s("tr",[s("td"),s("td",[s("input",{directives:[{name:"model",rawName:"v-model",value:t.search.company_name,expression:"search.company_name"}],staticClass:"form-control",attrs:{placeholder:"Tìm theo tên công ty"},domProps:{value:t.search.company_name},on:{input:function(s){s.target.composing||t.$set(t.search,"company_name",s.target.value)}}})]),s("td"),s("td"),s("td"),s("td")]),t._l(t.filteredContract,(function(a,e){return s("tr",{key:a.contract_id},[s("td",[t._v(t._s(e+1))]),s("td",[s("strong",{staticClass:"text-primary"},[t._v(" "+t._s(a.company.company_name))]),s("ul",{staticClass:"list-group"},t._l(a.details,(function(a){return s("li",{key:a.detail_id,staticClass:"list-group-item"},[t._v(" "+t._s(a.detail_content)+" ")])})),0)]),s("td",[t._v(t._s(a.company.company_taxcode))]),s("td",[1==a.contract_type?[s("span",{staticClass:"badge bg-warning bg-opacity-10 text-black"},[s("i",{staticClass:"fa-solid fa-circle-small"}),t._v(" Gia hạn")])]:[s("span",{staticClass:"badge bg-success bg-opacity-10 text-success"},[s("i",{staticClass:"fa-solid fa-circle-small"}),t._v(" Mới")])]],2),s("td",[s("strong",{staticClass:"text-danger"},[t._v(t._s(t.formatAmount(a.contract_total)))])]),s("th",[s("button",{staticClass:"btn btn-primary-soft btn-sm",on:{click:function(s){return t.chooseContract(a)}}},[s("i",{staticClass:"fa-regular fa-circle-arrow-right"})])])])}))],2)])]),0==t.contracts.length?s("NotFound"):t._e()],1)},k=[],$={components:{NotFound:c.Z},data(){return{contracts:[],search:{company_name:""}}},computed:{filteredContract(){return this.contracts.filter((t=>-1!==t.company.company_name.toLowerCase().indexOf(this.search.company_name.toLowerCase())))}},methods:{show(){this.$bvModal.show("modal-add-contract-comission"),this.getContracts()},formatAmount(t){return this.$econtract.formatAmout(t)},async getContracts(){this.$econtract.showLoading(),await axios.get("/commissions/contracts").then((t=>{this.contracts=t.data,this.$econtract.hideLoading()}))},chooseContract(t){this.$emit("chooseContract",t),this.$toast.success("Thêm hợp đồng thành công"),this.$bvModal.hide("modal-add-contract-comission")}}},T=$,M=(0,m.Z)(T,w,k,!1,null,null,null),Z=M.exports,N=a(4838),D={components:{turnChoose:u,turnAdd:y,Select2:x.Z,modalContractComission:Z,Money:N.Money},data(){return{Commission:{turn_name:"",comis_status:0,turn_id:0,partner_id:0,details:[],comis_total:0,price_to_text:"",comis_id:0},isUpdate:!1,asset:{title:"Lập phiếu thanh toán",contract_id:0,contract:{},product_price:0,percent:0,comis_price:0,company_name:""},partners:[],contracts:[],settings:{placeholder:"--Hãy chọn dữ liệu--",theme:"bootstrap-5",width:"100%"},money:{decimal:",",thousands:".",prefix:"",suffix:" ",precision:0,masked:!1},debounceTimeout:null}},watch:{"asset.contract.details":{handler:function(t){}},"asset.contract_id":{},"asset.percent":{handler:function(t){this.asset.comis_price=Math.round(this.asset.product_price*(t/100))},immediate:!1,deep:!0},"Commission.details":{handler:function(){this.Commission.comis_total=this.commisTotal(),this.Commission.price_to_text=this.$econtract.doc(this.Commission.comis_total)},immediate:!1,deep:!0}},created(){this.$route.params.id>0&&(this.isUpdate=!0,this.Commission.comis_id=this.$route.params.id,this.getCommissions(),this.asset.title="Cập nhật phiếu thanh toán"),this.getContracts(),this.getPartners()},computed:{filteredComissions(){return this.Commission.details.filter((t=>1!==t.isDelete))}},methods:{showModalContract(){this.$refs.modalContract.show()},chooseContract(t){this.asset.contract=t,this.asset.company_name=t.company.company_name,this.asset.product_price=this.totalDetails(t),this.asset.contract_id=t.contract_id},removeDetailItem(t){this.$confirm({title:"Xóa dịch vụ",message:"Bạn có muốn xóa thanh toán này?",button:{yes:"Yes",no:"No"},callback:s=>{s&&this.$set(this.Commission.details,t,{...this.Commission.details[t],isDelete:1})}})},removeDetail(t){let s=this;this.$confirm({title:"Xóa dịch vụ",message:"Bạn có muốn xóa dịch vụ này?",button:{yes:"Yes",no:"No"},callback:a=>{a&&s.asset.contract.details.splice(t,1)}})},addCommission(){if(this.asset.contract.contract_id>0&&this.asset.percent>0&&this.asset.comis_price>0){const t=0===this.asset.contract.contract_type?"Đăng ký mới ":"Gia hạn";this.Commission.details.push({company_name:this.asset.contract.company.company_name,company_taxcode:this.asset.contract.company.company_taxcode,company_address:this.asset.contract.company.company_address,comis_percent:this.asset.percent,revenue:this.asset.product_price,comis_price:this.asset.comis_price,contract_number:this.asset.contract.contract_number+"/"+this.asset.contract.details[0].category.pattern_contract,contract_date:this.$econtract.formatDate(this.asset.contract.contract_date),product_name:this.asset.contract.details[0].product.product_name,cate_name:this.asset.contract.details[0].category.cate_name,contract_id:this.asset.contract_id,detail_content:`${t} ${this.asset.contract.details[0].category.cate_name} ${this.asset.contract.details[0].product.product_name}`}),this.asset.contract={},this.asset.product_price=0,this.asset.percent=0,this.asset.comis_price=0}else this.$confirm({title:"Thông báo",message:"Bạn chưa chọn đủ thông tin thanh toán",button:{yes:"Yes"},callback:t=>{}})},commisTotal(){return this.filteredComissions.reduce(((t,s)=>parseFloat(t)+parseFloat(s.comis_price)),0)},showModalTurn(){this.$refs.turnChoose.show()},chooseTurn(t){this.Commission.turn_name=t.turn_name,this.Commission.turn_id=t.turn_id},turnAddSuccess(t){this.Commission.turn_name=t.turn_name,this.Commission.turn_id=t.turn_id},addTurn(){this.$refs.turnAdd.show()},totalDetails(t){return console.log(t.details),t.details.reduce(((t,s)=>t+s.detail_quantity*s.detail_product_price),0)},async store(){if(this.Commission.partner_id>0&&this.Commission.turn_id>0)return this.$confirm({title:"Thông báo",message:"Bạn chưa chọn đợt thanh toán hoặc CTV",button:{yes:"Yes"},callback:t=>{}}),!1;this.$econtract.showLoading(),delete this.Commission.turn_name,clearTimeout(this.debounceTimeout);try{let t;t=this.isUpdate?await i.Z.put("/commissions/update",this.Commission):await i.Z.post("/commissions",this.Commission),200==t.status&&this.$toast.success(this.isUpdate?"Cập nhật phiếu thanh toán thành công":"Thêm phiếu thanh toán thành công"),this.$router.push({name:"commission-index"})}catch(t){this.$toast.error("Có lỗi xảy ra trong quá trình xử lý")}finally{this.$econtract.hideLoading()}},async getPartners(){await i.Z.get("/partners").then((t=>{this.partners=t.data}))},async getCommissions(){this.$econtract.showLoading(),await i.Z.get(`/commissions/${this.Commission.comis_id}`).then((t=>{this.Commission=t.data,this.$econtract.hideLoading()}))},async getContracts(){await i.Z.get("/commissions/contracts").then((t=>{this.contracts=t.data.map((t=>({id:t.contract_id,text:t.company.company_name+` ( ${this.$econtract.formatAmout(t.contract_total)} )`,price:t.contract_total})))}))}}},L=D,S=(0,m.Z)(L,e,o,!1,null,null,null),Y=S.exports}}]);
//# sourceMappingURL=607.d8033e02.js.map